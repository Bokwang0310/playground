# 함수형 프로그래밍

> 이 글에 등장하는 예제들은 ES6+의 문법을 사용하고 있습니다. [W3C ES6](https://www.w3schools.com/js/js_es6.asp)

**함수형 프로그래밍**은 객체지향 프로그래밍과 마찬가지로 프로그래밍 **패러다임**의 한 종류입니다.

객체 지향 프로그래밍이라는 패러다임에 캡슐화, 상속, 다형성과 같은 특징들이 있었던 것처럼 함수형 프로그래밍도 마찬가지로 특징들이 있습니다.

- 선언형
- 일급 함수
- 순수 함수 (참조 투명성)
- 불변
- ...

이외에도 여러 가지 특징이 있지만 이번에는 이 4가지에 대해서 집중적으로 알아보도록 하겠습니다.

# 선언형

> 명령형 코드는 구체적으로 **어떻게** 그 일을 할 것이냐를 기술하는 방식인데요, 이것들을 **선언적**으로 기술하는 게 함수형 프로그래밍입니다. [함수형 프로그래밍과 ES6+](https://youtu.be/4sO0aWTd3yc)

선언형 프로그래밍은 [외부 파일](Declarative.md)로 분리했습니다.

# 일급 함수 (일급 객체로서의 함수)

> ... 보통 함수에 매개변수로 넘기기, 수정하기, 변수에 대입하기와 같은 연산을 지원할 때 일급 객체라고 한다. [위키피디아](https://ko.wikipedia.org/wiki/%EC%9D%BC%EA%B8%89_%EA%B0%9D%EC%B2%B4)

함수형 프로그래밍 언어에서 함수는 다음 3가지 조건을 만족시키는 **일급 객체**입니다.

- 변수에 할당 가능해야 한다.
- 함수의 인자로 사용될 수 있어야 한다.
- 함수의 반환값으로 사용될 수 있어야 한다.

위 3가지 조건을 한 문장으로 정리한다면 다음과 같습니다.

> 함수도 값이다.

함수가 값이기 때문에 변수에 할당할 수도, 함수의 인자로 넘길 수도, 함수가 반환할 수도 있는 것이죠.

자바스크립트는 이 3가지 조건을 다 지원하기 때문에 *자바스크립트에서의 함수는 일급 객체*라고 볼 수 있습니다.

```js
// 함수를 변수에 할당한다
const add = (a, b) => a + b;

// 함수의 인자로 함수를 넘긴다
const stopInterval = setInterval(() => {
  console.log("지났다 1초");
}, 1000);

// 함수의 반환값으로 함수를 받는다
stopInterval();
```

그래서 함수가 일급 객체라는 게 뭐 어떻다는 걸까요?

## 고차 함수

함수가 일급 객체이기 때문에 할 수 있는 것은 **고차 함수**를 만드는 것입니다.

고차 함수란 하나 이상의 함수를 인수로 취하거나 함수를 결과로 반환하는 함수를 말합니다.

위 예제 코드에서 봤던 `setInterval`은 인자로 함수를 받기도 하고 함수를 리턴하기도 하므로 고차 함수라고 볼 수 있습니다.

자바스크립트에서 고차 함수가 사용되는 예시를 더 보도록 하겠습니다.

```js
const arr = [1, 2, 3, 4, 5];

// 함수를 인자로 받는 고차 함수
console.log(arr.filter((a) => a % 2)); // [1, 3, 5]
document.body.addEventListener("click", () => {
  console.log("Clicked!");
});

// 함수를 반환하는 고차 함수
function sayAnything(msg) {
  return (msg) => console.log(msg);
}
/**
 * const sayAnything = (msg) => (msg) => console.log(msg);
 */

const sayHello = sayAnything("Hello?");
sayHello(); // "Hello?"
```

# 순수 함수 (참조 투명성)

순수 함수라는 말은 말 그대로 함수가 순수하다는 뜻입니다. 함수가 순수하다는 것은 무엇일까요? 코드를 봅시다.

```js
const pureAdd = (a, b) => a + b;

let data = 10;
const impureAdd = (a) => a + data;
```

`pureAdd` 함수는 함수의 매개변수 외에는 아무것도 참조하지 않기 때문에 같은 인자에 대해 항상 같은 함숫값을 보장해 줍니다.

```js
console.log(pureAdd(1, 2)); // 3
console.log(pureAdd(1, 2)); // 3
console.log(pureAdd(1, 2)); // 3
```

하지만 `impureAdd`는 매개변수 외에 함수 바깥에 있는 값을 참조하고 있기 때문에 함수의 인자로 같은 값을 넣더라도 계속해서 같은 값을 기대할 수 없습니다.

```js
console.log(impureAdd(1)); // 11
data = 1212;
console.log(impureAdd(1)); // 1213
data = "critical!";
console.log(impureAdd(1)); // "critical!1"
```

함수의 매개 변수 만을 참조하더라도 다음과 같은 상황은 순수 함수가 아닙니다.

```js
function impureAdd2(a, b) {
  console.log("Can I log anything?");
  return a + b;
}

console.log(impureAdd2(1, 2)); // 3
console.log(impureAdd2(1, 2)); // 3
console.log(impureAdd2(1, 2)); // 3
```

> ✋ 동일 인자에 동일 값을 반환하는데요?

함수가 순수하다는 말은 단순히 매개 변수에만 의존하여 동일한 함숫값을 낸다는 것뿐만이 아니라 **외부 세계에 영향을 주지 않는/받지 않는 함수**라는 뜻입니다.

그리고 외부 세계에 대한 영향을 **사이드 이펙트(Side Effect)** 라고도 부릅니다.

> 사이드 이펙트, 부작용, 부수 효과

위 예제에서는 `console.log`를 통해 외부 세계에 영향을 주기 때문에 순수하다고 볼 수 없습니다.

> ✋✋; 그럼 외부 세계에 영향을 주지 않는 프로그램만 만들라는 건가요?

물론 프로그램에서 모든 함수를 순수하게 만들 수는 없습니다. 하지만 최대한 순수할 수 있게 만들 수 있는 것은 순수하게 만들고 그것들을 순수하지 않은 함수와는 분리하여 최대한 예측할 수 있는 값을 만들어내기 위한다는 의미를 가지고 있습니다.

# 불변성

불변(Immutability)이란, 변하지 않는다는 뜻을 가지는 단어입니다. 이와 반대되는 말에는 가변(Mutability)이 있습니다. 그런데 무엇이 불변이라는 것일까요?

함수형 프로그래밍에서는 **변수가 없습니다**. 즉, 값이 불변합니다.

여기서 변수는 프로그래밍에서 말하는 값을 저장하는 메모리가 아니라 말 그대로 **변하는 수**를 말합니다. 수학에서의 변수와 비슷한 뜻을 가지고 있죠.

프로그래밍을 하면서 아래와 같은 코드를 많이 봐왔을 것입니다.

```js
let msg = "첫인사";
console.log(msg);

msg = "끝인사"; // 여기
console.log(msg);

for (let i = 0; i < 10; i++) { // 여기
  console.log(`i`번);
}
```

> `여기`에서 불변이 지켜지고 있지 않습니다.

그럼 왜 위와 같은 코드는 함수형 프로그래밍에서 허용되지 않고 불변성을 지켜야하는 것일까요?

## 의도치 않은 상태의 변화

순수 함수를 쓰는 이유가 부수 효과를 피하기 위해서 였던 것과 마찬가지로 불변성 역시 부수 효과를 피하기 위해 지켜야 합니다.

가령,

```js
let myAge = 18;

console.log("파일을 채우는 어떤 코드1");
someFunction1();
console.log("파일을 채우는 어떤 코드2");
someFunction2();
// 그 사이 수 많은 코드들 ...
myAge = 92;
console.log("파일을 채우는 어떤 코드91981");
someFunction91981();
console.log("파일을 채우는 어떤 코드91982");
someFunction91982();

myAge가18이어야작동하는함수(myAge); // ?
```

이처럼 상태가 변경될 수 있는 상황에서 변수의 값이 일정하다는 것이 보장되지 않기 때문에 많은 일이 일어날 수 있습니다.

### 예측할 수 없는 프로그램

`myAge가18이어야작동하는함수`가 에러를 내고 프로그램이 죽어버린다면 차라리 다행일지도 모릅니다.

에러 없이 쓰레기 값이 들어온 채로 뭔가 이상한 결과를 계속 만들어내고 있다면? 이런 일이 고객이 사용하는 웹사이트, 은행 앱 등에서 일어난다면?

### 비동기 프로그래밍

알파고 이후에 AI에 대한 관심이 급격하게 높아지면서 비로소 AI의 시대에 빠른 속도로 가까워지고 있는 현대 사회에서는 많은 양의 데이터를 다루는 일이 아주 많습니다.

하지만 컴퓨터의 속도에는 한계가 있고 사람들은 여러 일을 동시에 하는 방법으로 컴퓨팅 능력의 한계로부터 벗어나고자 하였습니다.

그런데 이런 비동기/동시성 프로그래밍을 할 때 변경될 수 있는 상태가 여러 곳에서 사용된다면 어떤 일이 일어날지 알 수 없습니다.

이런 부작용을 막기 위해서 **불변성**과 위에서 말했던 **순수 함수**를 지향하는 함수형 프로그래밍이 비동기 프로그래밍과 함께 많은 관심을 받고 있습니다.

### 상태 변화 추적

https://ljs0705.medium.com/react-state%EA%B0%80-%EB%B6%88%EB%B3%80%EC%9D%B4%EC%96%B4%EC%95%BC-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0-ec2bf09c1021

## 자바스크립트에서 불변성

자바스크립트에서는 `const`라는 변수 선언 키워드를 통해 불변 변수를 선언할 수 있습니다.

```js
const immutable = 1;
immutable = 2; // Uncaught TypeError: Assignment to constant variable.
```

하지만 주의해야 할 점이 있습니다. 참조형 데이터는 우리가 생각하는 불변이 제대로 이루어지지 않을 수 있다는 점입니다.
